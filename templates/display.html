<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Message</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: auto;
            margin: 0;
            background-color: #121212;  /* Dark background */
            color: #f0f0f0;  /* Light text color */
        }

        .card {
            background-color: #1e1e1e;  /* Dark card background */
            /*border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); */
            width: auto;
            padding: 20px;
            text-align: center;
        }

        .card-header {
            font-size: 28px;
            font-weight: bold;
            color: #bb86fc;  /* Light purple for header */
        }

        .card-body {
            font-size: 18px;
            color: #e4c600;  /* White text for body */
            margin-top: 5px;
        }

        #messageBox {
            font-size: 30px;
            padding: 10px;
            border: 1px solid #333;
            background-color: #333;  /* Dark background for message box */
            color: #e4c600;  /* Light text color for message box */
            border-radius: 4px;
            border: 2px solid #f39c12;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
            height: auto;
        }

        .fade-in {
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .fade-out {
            animation: fadeOut 1s ease-in-out forwards;
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.9); }
        }

        #heartContainer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        }

        .heart-float {
            position: absolute;
            bottom: 0;
            font-size: 4rem;
            animation: floatUp 3s linear forwards;
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100vh); opacity: 0; }
        }

        img {
            max-width: 100%;
            border-radius: 10px;
        }
        .social-link {
            color: #ffcc00;
            text-decoration: none;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="container pt-2">

        <div class="container pt-2">
            <div class="row border border-3 border-warning rounded p-2">
                <div class="col-sm-12">
                    <center><h3 id="time"></h3></center>
                </div>
            </div>
        </div>

        <div class="container pt-2">
            <div class="row">
              
                <div class="col-sm-8">
                    <div class="row border border-3 border-warning rounded">
                        <div class="col-sm-12">
                            <div class="card">
                                <div class="card-header" id="usernameBox">Waiting for message...</div>
                                <div class="card-body">
                                    <div id="messageBox">Waiting for message...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row border border-3 border-warning rounded">
                        <div class="col-sm-12">
                            Level 2: .col-4 .col-sm-6
                        </div>
                    </div>
                </div>
                
                <div class="col-sm-4 border border-3 border-warning rounded">
                     <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ -->
                     <div id="imageContainer"></div>

                </div>
                  

            </div>
          </div>
    </div>


    <div id="heartContainer"></div>

    <script>
        var socket = io();
        var messageQueue = []; // ‡∏Ñ‡∏¥‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
        var isProcessing = false; // ‡πÉ‡∏ä‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏≠‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏ß
        function processMessages() {
            if (messageQueue.length > 0 && !isProcessing) {
                isProcessing = true; // ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                var currentMessage = messageQueue.shift(); // ‡πÄ‡∏≠‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏Å‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏ß
                var messageBox = document.getElementById("messageBox");
                var usernameBox = document.getElementById("usernameBox");

                // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡πÉ‡∏ô card-header
                usernameBox.innerText = currentMessage.username;

                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô messageBox
                messageBox.innerText = currentMessage.message;

                speakMessage(currentMessage.message);

                // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏Å‡∏û‡∏±‡∏Å
                setTimeout(function() {
                    messageBox.classList.add("fade-out");
                }, 10000);  // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏™‡∏î‡∏á 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô messageBox ‡πÄ‡∏õ‡πá‡∏ô "Waiting for message..." ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
                setTimeout(function() {
                    //messageBox.innerText = "Waiting for message...";
                    messageBox.classList.remove("fade-out");

                    // ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏ß
                    isProcessing = false;
                    processMessages();  // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                }, 11000);  // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 11 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢
        function updateTime() {
            var options = { timeZone: 'Asia/Bangkok' };
            var now = new Date();

            // ‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô "DD/MM/YYYY HH:mm:ss"
            var day = ("0" + now.getDate()).slice(-2);
            var month = ("0" + (now.getMonth() + 1)).slice(-2);
            var year = now.getFullYear();
            var hours = ("0" + now.getHours()).slice(-2);
            var minutes = ("0" + now.getMinutes()).slice(-2);
            var seconds = ("0" + now.getSeconds()).slice(-2);

            var time = day + "/" + month + "/" + year + " " + hours + ":" + minutes + ":" + seconds;
            document.getElementById("time").innerText = time;
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        setInterval(updateTime, 1000);

        socket.on('sendHeart', function() {
            createHeart();
        });

         // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á
        function speakMessage(message) {
            var speech = new SpeechSynthesisUtterance(message);
            speech.voice = speechSynthesis.getVoices().find(function(voice) {
                return voice.name === 'Google UK English Female';  // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢ Siri (‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)
            }) || speechSynthesis.getVoices()[0];  // ‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á 'Samantha'
            speech.lang = 'th-TH';  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
            speechSynthesis.speak(speech);
        }

        socket.on('latestMessage', function(data) {
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏Ñ‡∏¥‡∏ß
            messageQueue.push(data);
            processMessages(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏ß
        });
    </script>
    <script>
        var socket = io();
    
        socket.on('sendHeart', function() {
            createHeart();
        });
    
        function createHeart() {
            let heart = document.createElement("div");
            heart.innerHTML = "‚ù§Ô∏è";
            heart.className = "heart-float";
            heart.style.left = Math.random() * 80 + "vw"; 
            document.getElementById("heartContainer").appendChild(heart);
    
            setTimeout(() => { heart.remove(); }, 4000);
        }
    </script>
    <script>
        var socket = io();

        socket.on("newImage", function(data) {
            var imgContainer = document.getElementById("imageContainer");
            var socialIcon = {
                "facebook": "üìò",
                "instagram": "üì∑",
                "twitter": "üê¶",
                "tiktok": "üéµ",
                "youtube": "‚ñ∂Ô∏è"
            }[data.social] || "üîó";  // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô üîó

            var socialLinkHTML = data.link ? `<a href="${data.link}" target="_blank" class="social-link">${socialIcon} ${data.social}</a>` : "";

            imgContainer.innerHTML = `<div class="card">
                <img src="${data.imageUrl}" alt="Uploaded Image">
                <p>${socialLinkHTML}</p>
            </div>`;
        });
    </script>
    <script>
        var socket = io();
        var imageQueue = [];
        var isImageProcessing = false;

        function processImages() {
            if (imageQueue.length > 0 && !isImageProcessing) {
                isImageProcessing = true;
                var currentImage = imageQueue.shift();
                var imgContainer = document.getElementById("imageContainer");
                imgContainer.innerHTML = `<img src="/static/uploads/${currentImage}" alt="load" class="img-fluid rounded">`;
                setTimeout(() => {
                    imgContainer.innerHTML = "";
                    isImageProcessing = false;
                    processImages();
                }, 10000);
                

            }
        }
        socket.on("newImage", function(data) {
            imageQueue.push(data.filename);
            processImages();
        });
    </script>

</body>
</html>
